# Реализация протокола Stop and Wait 

## Протокол

Протокол соответствует описанному в задании (rdt 3.0), с небольшими модификациями:

1. Номера пакетов не ограничены 0 или 1
2. После отправки всех пакет с данными, отправитель посылает `FIN`-пакеты до тех пор, пока не получит `FIN ACK`, либо пока не отправит установленное количество `FIN`-пакет. Получатель после первого `FIN`-пакета отправит `FIN ACK`, но при этом будет ждать дальше (на случай если этот пакет потерялся), до истечения заданного тайм-аута.


## Сервер

Сервер запускается командой
```
 ./gradlew server:run --args="<port>"
```
Где `port` -- номер порта, который будет слушать сервер. Например, если надо запустить сервер на порту `3456` команда будет выглядеть как
```
./gradlew server:run --args="3456"
```

## Клиент

Клиент запускается командой
```
./gradlew client:run --args="<args>"
```

Клиент получает следующие аргументы:
* `host` -- адрес сервера
* `port` -- порт сервера
* `query` -- тип запроса. Может принимать одно из двух значений: `GET` или `UPLOAD` -- получить файл с сервера, или загрузить файл на сервер
* `filename` -- имя скачиваемого/загружаемого файла


## Конфигурация сети
Конфигурация задается в файле [config.yaml](common/src/main/resources/config.yaml) в модуле `common`. Там можно задать следующие настройки:

* `ackTimeoutMillis` -- время ожидания ack-а (в миллисекундах), по истечении которого пакет будет отправлен повторно
* `dropRate` -- частота симулирования потери пакета
* `corruptionRate` -- частота симулирования повреждения (изменения случайных битов) данных
* `maxDataSize` -- максимальный размер (в байтах) полезной нагрузки одного пакета
* `senderMaxFinCount` -- максимальное количество раз, которое отправитель может отправить `FIN`-пакета (см. [описание протокола](#протокол))
* `receiverTimeoutMillis` -- таймаут, по истечении которого получатель перестает ожидать новые пакеты (см. [описание протокола](#протокол))

## Контрольные суммы
Алгоритм подсчета контрольных сумм реализован в [Checksums.kt](common/src/main/kotlin/aliexpresstcp/Checksums.kt).
Примеры его работы можно увидеть ниже

## Примеры логов при GET/UPLOAD-запросах
Пример GET-запроса с битыми данными и сработавшей проверкой контрольной суммы. Слева сервер, справа клиент
<div>
<img src="https://user-images.githubusercontent.com/65076429/233231463-29fffffa-d691-4527-92d9-3aea95e87776.png" width=45%> 
<img src="https://user-images.githubusercontent.com/65076429/233231483-c61bda2c-91bf-41b0-9023-096d5c799904.png", width=45%>
</div>

Ниже пример UPLOAD-запроса с потерянными пакетами (опять же, слева сервер, справа клиент)
<div>
<img src="https://user-images.githubusercontent.com/65076429/233233382-583cd7c2-c1cd-4e68-8860-0cf100274b12.png" width=45%>
<img src="https://user-images.githubusercontent.com/65076429/233232640-8e182c20-280a-441c-a781-245976b074ff.png" width=45%>
</div>
